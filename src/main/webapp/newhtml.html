<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>
    <body>
        <div>TODO write content</div>
        <table id="table">
        </table>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
        <script src="jquery.mask.min.js"></script>

        <script type="text/javascript">
            function FlowEntryItem() {
                this.name;
                this.no;
                this.quotes = new Array();
                this.total;
            }

            function FlowEntryQuote() {
                this.quote;
                this.month;
            }

            var ITEM_TEMPLATE = "<tr rowid='${rowid}'><td><input  type='text'value='${name}' /></td><td><input type='text' value='${no}' /></td>";
            var QUOTE_TEMPLATE = "<td><input type='text' class='money' value='${quote}' /></td>";

            $(document).ready(function () {
                var table = $("#table");

                table.bind("keydown.body", function (e) {
                    switch (e.keyCode) {
                        case 37: //controla o evento do bot達o ESQUERDO, coloca foco no input ao lado.
                            if (e.target.parentElement.previousElementSibling)
                                $(e.target.parentElement.parentElement.cells[e.target.parentElement.cellIndex - 1]).find("input").focus();
                            break;
                        case 38: //controla o evento do bot達o para CIMA, coloca foco no input acima.
                            if (e.target.parentElement.parentElement.previousElementSibling)
                                $(e.target.parentElement.parentElement.previousElementSibling.cells[e.target.parentElement.cellIndex]).find("input").focus();
                            break;
                        case 39: //controla o evento do bot達o DIREITO, coloca foco no input ao lado.
                            if (e.target.parentElement.nextElementSibling)
                                $(e.target.parentElement.parentElement.cells[e.target.parentElement.cellIndex + 1]).find("input").focus();
                            break;
                        case 40: //controla o evento do bot達o para BAIXO, coloca foco no input abaixo.
                            if (e.target.parentElement.parentElement.nextElementSibling)
                                $(e.target.parentElement.parentElement.nextElementSibling.cells[e.target.parentElement.cellIndex]).find("input").focus();
                            break;


                        default:
                            break;
                    }
                });
                var items = new Array();

                var initialDate = new Date();
                var endDate = new Date();

                endDate.setYear(2018);

                var createHeader = function () {
                    var headerHTML = "<thead><tr><th>Item</th><th>NO</th>";

                    var datecurrent = new Date(initialDate);

                    while (datecurrent < endDate) {
                        headerHTML += "<th>" + datecurrent.toLocaleDateString("pt-br").slice(3) + "</th>";

                        datecurrent.setMonth(datecurrent.getMonth() + 1);
                    }

                    headerHTML += "<th>Parcelas</th><th>Total</th></tr></thead>";
                    table.append(headerHTML);
                }


                var initValues = function () {
                    for (var i = 0; i < 5; i++) {
                        var flowItem = new FlowEntryItem();
                        flowItem.name = "Item " + i;
                        flowItem.no = Math.floor(Math.random() * 9999) + 1;

                        var datecurrent = new Date(initialDate);

                        while (datecurrent < endDate) {
                            var quote = new FlowEntryQuote();
                            quote.month = datecurrent;
                            quote.quote = Math.floor(Math.random() * 80000) + 1;

                            datecurrent.setMonth(datecurrent.getMonth() + 1);

                            flowItem.quotes.push(quote);
                        }

                        items.push(flowItem);
                    }
                }

                var createBodyHTML = function () {

                    items.forEach(function (item) {
                        var row = ITEM_TEMPLATE.replace("${rowid}", Math.floor(Math.random() * 3) + 3);

                        row = row.replace("${name}", item.name);
                        row = row.replace("${no}", item.no);

                        item.total = 0;

                        item.quotes.forEach(function (quote) {
                            row += QUOTE_TEMPLATE.replace("${quote}", quote.quote);

                            item.total += quote.quote;
                        });

                        row += "<td><input type='text' value='" + item.quotes.length + "' /></td>";
                        row += "<td><input type='text'  pattern='(d{3})([.])(d{2})' value='" + item.total + "' /></td></tr>";

                        table.append(row);
                    });
                }

                createHeader();
                initValues();
                createBodyHTML();

                $('.money').mask("#.##0,00", {reverse: true});
            });
        </script>
    </body>
</html>

